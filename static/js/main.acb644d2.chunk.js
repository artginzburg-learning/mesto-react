(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{13:function(e){e.exports=JSON.parse('{"a":"Art Ginzburg"}')},18:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var r,a,c,i=n(1),o=n.n(i),s=n(12),u=n.n(s),l=(n(18),n(4)),d=n.n(l),p=n(2),b=n(10),h=n(6),m=n(3),f=n(8),j=n(9),_="mesto.nomoreparties.co",v="https://",O="v1",x=new(function(){function e(t){var n=this;Object(f.a)(this,e),this._handleFetch=function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))},this.editProfile=function(e){var t=e.name,r=e.about;return n._customFetch("users/me","PATCH",{name:t,about:r})},this.addCard=function(e,t){return n._customFetch("cards","POST",{name:e,link:t})},this.deleteCard=function(e){return n._customFetch("cards/".concat(e),"DELETE")},this.changeLikeCardStatus=function(e,t){return n._customFetch("cards/likes/".concat(e),t?"PUT":"DELETE")},this.updateAvatar=function(e){var t=e.avatar;return n._customFetch("users/me/avatar","PATCH",{avatar:t})},this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(j.a)(e,[{key:"_customFetch",value:function(e,t,n){var r={headers:this._headers};return t&&"GET"!==t&&(r.method=t,"DELETE"!==t&&(r.headers["Content-Type"]="application/json")),n&&(r.body=JSON.stringify(n)),fetch("".concat(this._baseUrl,"/").concat(e),r).then(this._handleFetch)}},{key:"getUserInfo",value:function(){return this._customFetch("users/me")}},{key:"getInitialCards",value:function(){return this._customFetch("cards")}}]),e}())({baseUrl:"".concat(v).concat(_,"/").concat(O,"/").concat("cohort-24"),headers:{authorization:"70313b07-c3c0-40aa-a296-04d0e6bc7885"}}),g="popup__close-button",C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},k=n(0),S={get currentUser(){return localStorage.currentUser?JSON.parse(localStorage.currentUser):{}},set currentUser(e){return localStorage.currentUser=JSON.stringify(e)}},y={name:null!==(r=S.currentUser.name)&&void 0!==r?r:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439",about:null!==(a=S.currentUser.about)&&void 0!==a?a:"\u041f\u043e\u0442\u0435\u0440\u044f\u043d\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c",avatar:null!==(c=S.currentUser.avatar)&&void 0!==c?c:""},E=o.a.createContext(),N=o.a.createContext();function L(e){var t=e.children,n=o.a.useState(y),r=Object(m.a)(n,2),a=r[0],c=r[1];return o.a.useEffect((function(){x.getUserInfo().then((function(e){return S.currentUser=e,c(e)}))}),[c]),o.a.useEffect((function(){S.currentUser=a}),[a]),Object(k.jsx)(E.Provider,{value:a,children:Object(k.jsx)(N.Provider,{value:c,children:t})})}function w(){var e=o.a.useContext(E);if(void 0===e)throw new Error("useCurrentUser must be used within a CurrentUserProvider");return e}function U(){var e=o.a.useContext(N);if(void 0===e)throw new Error("useCurrentUserDispatcher must be used within a CurrentUserProvider");return e}function P(){return(P=Object(h.a)(d.a.mark((function e(t,n,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(Object(p.a)(Object(p.a)({},n),r)),e.prev=1,e.next=4,x.editProfile(r);case 4:a=e.sent,t(a),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(1),t(n),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function T(){return(T=Object(h.a)(d.a.mark((function e(t,n,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(Object(p.a)(Object(p.a)({},n),r)),e.prev=1,e.next=4,x.updateAvatar(r);case 4:a=e.sent,t(a),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(1),t(n),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}var F=n.p+"static/media/logo.6fa47d29.svg";var I=function(){return Object(k.jsx)("header",{className:"header",children:Object(k.jsx)("a",{target:"_self",href:"https://github.com/artginzburg/mesto-react",className:"logo header__logo",children:Object(k.jsx)("img",{className:"logo__img",alt:"Mesto",src:F})})})};var A=function(e){var t,n=e.card;n.likes=null!==(t=n.likes)&&void 0!==t?t:[];var r=w();n.isTemporarilyLocal&&(n.owner=r);var a="element__trash-button"+(n.owner._id===r._id?" element__trash-button_visible":""),c="element__like-button"+(n.likes.some((function(e){return e._id===r._id}))?" element__like-button_active":"");return Object(k.jsxs)("li",{className:"element",children:[Object(k.jsx)("img",{onClick:function(){e.onCardClick(n)},className:"element__image",alt:n.name,src:n.link}),Object(k.jsx)("button",{onClick:function(){n.isTemporarilyLocal||e.onCardDelete(n)},type:"reset",className:a}),Object(k.jsxs)("div",{className:"element__container",children:[Object(k.jsx)("h2",{className:"element__title",children:n.name}),Object(k.jsxs)("div",{className:"element__likes",children:[Object(k.jsx)("button",{onClick:function(){n.isTemporarilyLocal||e.onCardLike(n)},type:"button",className:c}),Object(k.jsx)("p",{className:"element__like-counter",children:n.likes.length})]})]})]})};function D(e){var t=w();return Object(k.jsxs)("main",{className:"content",children:[Object(k.jsxs)("section",{className:"profile",children:[Object(k.jsx)("button",{onClick:e.onEditAvatar,type:"button",className:"profile__avatar-container",children:Object(k.jsx)("img",{alt:"\u0410\u0432\u0430\u0442\u0430\u0440",className:"profile__avatar",src:t.avatar})}),Object(k.jsxs)("div",{className:"profile__info",children:[Object(k.jsx)("h1",{className:"profile__name",children:t.name}),Object(k.jsx)("p",{className:"profile__description",children:t.about}),Object(k.jsx)("button",{onClick:e.onEditProfile,type:"button",className:"profile__edit-button"})]}),Object(k.jsx)("button",{onClick:e.onAddPlace,type:"button",className:"profile__add-button"})]}),Object(k.jsx)("section",{className:"elements",children:Object(k.jsx)("ul",{className:"elements__list",children:e.cards.map((function(t){var n;return Object(k.jsx)(A,{onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete,card:t},null!==(n=t._id)&&void 0!==n?n:Math.random())}))})})]})}var q=n(13);var B=function(){return Object(k.jsx)("footer",{className:"footer",children:Object(k.jsxs)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/artginzburg",className:"footer__copyright",children:["\xa9 2021 ",q.a]})})};var J=function(e){var t;return Object(k.jsx)("section",{onClick:e.onClose,className:"popup"+(e.isOpen?" popup_opened":""),id:e.name,children:Object(k.jsxs)("div",{className:"popup__container",children:[Object(k.jsx)("button",{type:"reset",className:g}),Object(k.jsx)("h2",{className:"popup__title",children:e.title}),Object(k.jsxs)("form",{onSubmit:function(t){e.onSubmit&&(t.preventDefault(),e.onSubmit()),e.children&&t.target.reset(),e.onSubmit&&document.activeElement.blur()},className:"popup__form",action:"#",children:[e.children,Object(k.jsx)("button",{type:"submit",className:"popup__button",children:null!==(t=e.buttonTitle)&&void 0!==t?t:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]})})},z=o.a.forwardRef((function(e,t){var n,r,a="text",c=null!==(n=e.type)&&void 0!==n?n:a,i=c===a?2:null;return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("input",Object(p.a)(Object(p.a)({},e),{},{ref:t,className:"popup__input",type:c,minLength:null!==(r=e.minLength)&&void 0!==r?r:i})),Object(k.jsx)("p",{className:"popup__error",id:"".concat(e.id,"-error")})]})}));function H(e){var t=o.a.useState(""),n=Object(m.a)(t,2),r=n[0],a=n[1],c=o.a.useState(""),i=Object(m.a)(c,2),s=i[0],u=i[1],l=w(),d=U();return o.a.useEffect((function(){a(l.name),u(l.about)}),[l]),Object(k.jsxs)(J,Object(p.a)(Object(p.a)({},e),{},{onSubmit:function(){!function(e,t,n){P.apply(this,arguments)}(d,l,{name:r,about:s}),e.onUpdateUser()},title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"profile-editor",children:[Object(k.jsx)(z,{value:r,onChange:function(e){a(e.target.value)},autoComplete:"name",autoCapitalize:"words",name:"name",id:"profile-name",placeholder:"\u0418\u043c\u044f",maxLength:"40",required:!0}),Object(k.jsx)(z,{value:s,onChange:function(e){u(e.target.value)},name:"about",id:"profile-about",placeholder:"\u041e \u0441\u0435\u0431\u0435",maxLength:"200",required:!0})]}))}function M(e){var t=Object(i.createRef)(),n=w(),r=U();return Object(k.jsx)(J,Object(p.a)(Object(p.a)({},e),{},{onSubmit:function(){!function(e,t,n){T.apply(this,arguments)}(r,n,{avatar:t.current.value}),e.onUpdateAvatar()},title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"avatar-editor",children:Object(k.jsx)(z,{ref:t,type:"url",name:"avatar",id:"profile-avatar",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0})}))}function V(e){var t=Object(i.useState)(""),n=Object(m.a)(t,2),r=n[0],a=n[1],c=Object(i.useState)(""),o=Object(m.a)(c,2),s=o[0],u=o[1];return Object(k.jsxs)(J,Object(p.a)(Object(p.a)({},e),{},{onSubmit:function(){e.onAddPlace(r,s),a(""),u("")},title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"element-editor",buttonTitle:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",children:[Object(k.jsx)(z,{value:r,onChange:function(e){a(e.target.value)},name:"title",id:"element-title",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",maxLength:"30",required:!0}),Object(k.jsx)(z,{value:s,onChange:function(e){u(e.target.value)},type:"url",name:"link",id:"element-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0})]}))}function G(e){return Object(k.jsx)(J,Object(p.a)(Object(p.a)({},e),{},{onSubmit:function(){e.onCardDelete(e.card)},title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",name:"delete-confirmation",buttonTitle:"\u0414\u0430"}))}var R=function(e){var t=e.card;return Object(k.jsx)("section",{onClick:e.onClose,className:"popup popup_type_image"+(e.isOpen?" popup_opened":""),id:"image-viewer",children:Object(k.jsxs)("figure",{className:"popup__figure",children:[Object(k.jsx)("button",{type:"button",className:"".concat(g," ").concat(g,"_parent-corners_straight")}),Object(k.jsx)("img",{className:"popup__image",alt:t.name,src:t.link}),Object(k.jsx)("figcaption",{className:"popup__caption",children:t.name})]})})},K={get cards(){return localStorage.cards?JSON.parse(localStorage.cards):[]},set cards(e){return localStorage.cards=JSON.stringify(e)}};function Q(){var e,t=o.a.useState(!1),n=Object(m.a)(t,2),r=n[0],a=n[1],c=o.a.useState(!1),i=Object(m.a)(c,2),s=i[0],u=i[1],l=o.a.useState(!1),f=Object(m.a)(l,2),j=f[0],_=f[1],v=o.a.useState(!1),O=Object(m.a)(v,2),C=O[0],S=O[1],y=o.a.useState(!1),E=Object(m.a)(y,2),N=E[0],L=E[1],U=o.a.useState({}),P=Object(m.a)(U,2),T=P[0],F=P[1],A=o.a.useState(null!==(e=K.cards)&&void 0!==e?e:[]),q=Object(m.a)(A,2),J=q[0],z=q[1],Q=w();function W(){return(W=Object(h.a)(d.a.mark((function e(t){var n,r,a,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=J,r=t.likes.some((function(e){return e._id===Q._id})),a=r?t.likes.filter((function(e){return e._id!==Q._id})):[].concat(Object(b.a)(t.likes),[Q]),c=Object(p.a)(Object(p.a)({},t),{},{likes:a}),z(J.map((function(e){return e._id===t._id?c:e}))),e.prev=5,e.next=8,x.changeLikeCardStatus(t._id,!r);case 8:i=e.sent,z(J.map((function(e){return e._id===t._id?i:e}))),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(5),z(n),e.t0;case 16:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function X(){_(!1),a(!1),u(!1),S(!1),L(!1)}function Y(e){(e.target===e.currentTarget||e.target.classList.contains(g))&&X()}o.a.useEffect((function(){x.getInitialCards().then((function(e){return K.cards=e,z(e)}))}),[z]),o.a.useEffect((function(){K.cards=J}),[J]);var Z=X,$=X;var ee=o.a.useCallback((function(e){"Escape"===e.key&&X()}),[]);return o.a.useEffect((function(){var e,t=["keydown",ee,!1];return(e=document).addEventListener.apply(e,t),function(){var e;return(e=document).removeEventListener.apply(e,t)}}),[ee]),Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(I,{}),Object(k.jsx)(D,{onEditProfile:function(){a(!0)},onAddPlace:function(){u(!0)},onEditAvatar:function(){_(!0)},cards:J,onCardClick:function(e){F(e),L(!0)},onCardLike:function(e){return W.apply(this,arguments)},onCardDelete:function(e){F(e),S(!0)}}),Object(k.jsx)(B,{}),Object(k.jsx)(H,{onUpdateUser:Z,isOpen:r,onClose:Y}),Object(k.jsx)(V,{onAddPlace:function(e,t){var n=J;z([{isTemporarilyLocal:!0,name:e,link:t}].concat(Object(b.a)(J))),x.addCard(e,t).then((function(e){return z([e].concat(Object(b.a)(J)))})).catch((function(){return z(n)})),X()},isOpen:s,onClose:Y}),Object(k.jsx)(M,{onUpdateAvatar:$,isOpen:j,onClose:Y}),Object(k.jsx)(G,{card:T,onCardDelete:function(e){var t=J;z(J.filter((function(t){return t._id!==e._id}))),x.deleteCard(e._id).catch((function(e){throw z(t),e})),X()},isOpen:C,onClose:Y}),Object(k.jsx)(R,{card:T,isOpen:N,onClose:Y})]})}var W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,22)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))},X=function(){function e(t,n){var r=this;Object(f.a)(this,e),this._showInputError=function(e,t){var n=r._element.querySelector("#".concat(e.id,"-error"));e.classList.add(r._data.inputErrorClass),n.textContent=t,n.classList.add(r._data.errorClass)},this._hideInputError=function(e){var t=r._element.querySelector("#".concat(e.id,"-error"));e.classList.remove(r._data.inputErrorClass),t.classList.remove(r._data.errorClass),t.textContent=""},this._resetFormErrors=function(){r._inputList.forEach((function(e){return r._hideInputError(e)})),r._toggleButtonState(1)},this._checkInputValidity=function(e){return e.validity.valid?r._hideInputError(e):r._showInputError(e,e.validationMessage)},this._hasInvalidInput=function(e){return e.some((function(e){return!e.validity.valid}))},this._toggleButtonState=function(e){return r._buttonElement.disabled=e||r._hasInvalidInput(r._inputList)},this._validationHandler=function(e){r._checkInputValidity(e),r._toggleButtonState()},this._setListeners=function(){r._element.addEventListener("reset",r._resetFormErrors),r._inputList.forEach((function(e){return e.addEventListener("input",(function(){return r._validationHandler(e)}))}))},this._data=t,this._element=n,this._inputList=Array.from(this._element.querySelectorAll(this._data.inputSelector)),this._buttonElement=this._element.querySelector(this._data.submitButtonSelector)}return Object(j.a)(e,[{key:"enableValidation",value:function(){this._toggleButtonState(),this._setListeners()}}]),e}();u.a.render(Object(k.jsx)(o.a.StrictMode,{children:Object(k.jsx)(L,{children:Object(k.jsx)(Q,{})})}),document.getElementById("root")),["#element-editor","#avatar-editor","#profile-editor"].forEach((function(e){new X(C,document.querySelector(e).querySelector(C.formSelector)).enableValidation()})),W()}},[[21,1,2]]]);
//# sourceMappingURL=main.acb644d2.chunk.js.map